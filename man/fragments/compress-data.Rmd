---
output:
  rmarkdown::html_vignette: default
  html_document: default
---

The complete tag history query output from [PTAGIS](https://ptagis.org/) (e.g., `ptagis_file`) will provide a record for every detection of each tag code in the tag list. Again, this may include multiple detections on the same antenna, or the same site within a short period of time, leading to an unwieldy and perhaps messy dataset. One of the main purposes of `PITcleanr` is to compress that data into an initial summary using the function `compress()`. At a minimum, this function requires a path e.g., `ptagis_file`, to the complete tag history query results downloaded from PTAGIS, as seen at the end of the [Querying Detection Data from PTAGIS] section. 

In our example, we perform the `compress()` function on the `ptagis_file` object containing the file path to our query results, and write the output to an object `comp_obs` containing the compressed observations.

```{r, eval = T}
# view path to example file, of course you can also set ptagis_file to your own PTAGIS query results
ptagis_file

# run compress() function on it
comp_obs = compress(ptagis_file)

# look at first parts of resulting object
head(comp_obs)

```

The output consists of a tibble containing columns for:

* **tag_code:** The unique PIT tag ID.
* **node:** By default, each site code from PTAGIS is considered a node. More on this below... 
* **slot:** A detection "slot" for each tag, numbered in chronological order. Also more on this below... 
* **event_type_name:** The type of "event". Typically, mark, observation, recapture, or recovery.
* **n_dets:** The number of detections that occurred within that slot.
* **min_det:** The time of the first (min) detection in the slot.
* **max_det:** The time of the last (max) detection in the slot.
* **duration:** The duration of that slot (maximum - minimum detection time). 
* **travel_time:** The travel time between the previous slot and that one. 

***A note on "nodes"***: By default, the `compress()` function considers a site code from PTAGIS as a node. A node, in cases, might correspond to, say, an individual PIT antenna. Although that level of detail in your detection data may be informative, it may also be unnecessary or excessive for your analysis. Instead, the user may choose to define their own groups (i.e., nodes), grouping detections by arrays, groups of arrays, groups of sites, or possibly even larger (e.g, any detection in **this** tributary!) depending on the spatial scale desired. To utilize this kind of grouping, a configuration file or table must be supplied to the `configuration` argument in the `compress()` function. More details on this topic are provided in the [Site Configuration] section below.

Each slot in the output is defined as all detections on a particular node before the tag is detected on a different node. The user can define a maximum number of minutes between detections before a new slot should be defined by supplying a value to the `max_minutes` argument to `compress()`. The units of the duration and travel_time columns can also be defined by the `units` argument. The default is minutes (`mins`). As an example, if a tag moves from node A to B and back to A, there will be three slots in the compressed data.

The help menu for `compress()`, or any function for that matter, can be accessed using:
```{r, eval = F}
?compress

```
